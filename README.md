# custom_pic_plugin

- 魔改自该插件仓库：https://github.com/1021143806/custom_pic_plugin



## 核心功能

- **智能触发**: 支持通过关键词（如"画图"）或 LLM 智能判定用户意图来触发绘图。
- **配置灵活**:
    - 自动生成 `config.toml` 配置文件。
    - 支持自定义模型、图片尺寸、附加提示词等高级参数。
    - 内置参数校验，自动修正不符合 API 规范的数值（如采样步数、引导系数），并提供清晰的日志提示。
- **缓存机制**: 缓存已生成的图片，节约时间和 API 调用次数。
- **本地画廊**: 自动将生成的图片保存到插件目录下的 `gallery` 文件夹中，方便回顾。
- **随机种子**: 支持设置随机种子为 `-1`，实现每次生成不同的随机图片。

## v0.10.0 适配说明

本插件已完全适配 MaiBot v0.10.0 的新插件架构：

- **移除了旧版本的直接导入**: 不再使用 `get_person_info_manager` 等内部函数
- **使用新的 API 系统**: 通过 `self.apis.send_api` 等标准 API 进行所有操作
- **符合新的插件规范**: 使用 `BasePlugin` 和 `BaseAction` 基类
- **配置系统升级**: 使用新的 `ConfigField` 配置系统，支持自动生成和验证

## 使用方法

1.  **安装插件**
    将插件文件夹放置在您的 MaiBot `plugins` 目录下。

2.  **配置插件**
    - 首次启动 MaiBot 后，插件会自动生成 `config.toml` 文件。
    - 打开 `config.toml`，根据文件内的注释说明，填入你的魔搭 API 密钥 (`api_key`)。
    - 你还可以根据需要调整 `[generation]` 部分的默认模型、图片尺寸和附加提示词等。

3.  **重启并使用**
    - 保存配置文件后，重启 MaiBot。
    - 现在，你可以通过"画一只太空猫"之类的指令来让你的 MaiBot 绘图了。

## 文件结构

- `plugin.py`: 插件核心逻辑。
- `_manifest.json`: 插件元数据，用于被 MaiBot 识别。
- `README.md`: 你正在阅读的说明文件。
- `config.toml`: (自动生成) 插件的配置文件。
- `gallery/`: (自动生成) 保存生成图片的本地画廊。

## 版本兼容性

- **v2.0.0**: 适配 MaiBot v0.10.0 新架构
- **v1.x**: 适用于 MaiBot v0.9.1 及更早版本

## 常见问题

- **API 密钥未配置/错误**：请检查 `config.toml` 中 `[api]` 部分的 `api_key` 是否已正确填写。
- **图片描述为空**：请确保在指令中提供了清晰的画面描述。
- **依赖缺失**：本插件依赖 `aiohttp` 库，MaiBot 的插件系统会自动处理。

## 更新日志

### v2.0.0 (2024-08-18)
- 完全适配 MaiBot v0.10.0 新插件架构
- 移除对内部函数的直接调用
- 使用新的 API 系统进行消息发送
- 更新配置系统以符合新规范
- 更新 manifest 文件格式

---

本项目基于 [MaiBot](https://github.com/MaiM-with-u/maibot) 框架开发。